---
title: Microsoft Power BI Premium 容量案例
description: 說明常見的 Power BI Premium 容量案例。
author: mgblythe
ms.author: mblythe
manager: kfile
ms.reviewer: ''
ms.service: powerbi
ms.subservice: powerbi-admin
ms.topic: conceptual
ms.date: 04/09/2019
ms.custom: seodec18
LocalizationGroup: Premium
ms.openlocfilehash: 1d666a6702515a935d93549d026f207848f2bca8
ms.sourcegitcommit: 60dad5aa0d85db790553e537bf8ac34ee3289ba3
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 05/29/2019
ms.locfileid: "65565338"
---
# <a name="premium-capacity-scenarios"></a>Premium 容量案例

這篇文章描述真實世界案例 Power BI premium 容量已實作的位置。 常見的問題與挑戰會描述，也如何找出問題，並協助解決這些問題：

- [保持最新的資料集](#keeping-datasets-up-to-date)
- [識別緩慢回應的資料集](#identifying-slow-responding-datasets)
- [識別原因偶爾緩慢回應的資料集](#identifying-causes-for-sporadically-slow-responding-datasets)
- [判斷是否有足夠的記憶體](#determining-whether-there-is-enough-memory)
- [判斷是否有足夠的 CPU](#determining-whether-there-is-enough-cpu)

步驟，以及圖表和資料表的範例是來自**Power BI Premium 容量度量的應用程式**，Power BI 系統管理員將擁有存取權。

## <a name="keeping-datasets-up-to-date"></a>保持最新的資料集

在此案例中，當使用者抱怨報表資料有時出現舊或 「 過時 」 時，已觸發調查。

在 應用程式時，系統管理員互動**重新整理**視覺效果，排序資料集**最大等待時間**統計資料，以遞減順序。 此視覺效果可幫助他們顯示具有最長的等候時間，依工作區名稱分組的資料集。

![依最大值遞減排序的資料集重新整理的等候時間，依 工作區](media/service-premium-capacity-scenarios/dataset-refreshes.png)

在 **每小時平均重新整理等候的時間**視覺效果中，客戶發現重新整理的等候時間一致尖峰大約下午 4 點每一天。

![重新整理等候尖峰定期在下午 4 點](media/service-premium-capacity-scenarios/peak-refresh-waits.png)

有數個可能的解釋，對於這些結果：

- 重新整理嘗試次數過多可能發生在同一時間，超過容量節點所定義的限制。 在此案例中，在預設記憶體配置為 P1 的六個並行重新整理。

- 若要重新整理的資料集可能太大而無法放入可用的記憶體 （需要完整的重新整理所需的記憶體至少 2x）。
- 效率不佳的 Power Query 邏輯可能會導致資料集重新整理期間的記憶體使用量暴增。 在忙碌的容量，這個特殊圖文集可以偶爾會觸達實體的限制，無法重新整理，並有可能會影響其他報表來檢視作業的容量。
- 要儲存於記憶體中的經常查詢資料集可能會影響其他資料集重新整理因為有限的可用記憶體的能力。

若要協助調查，Power BI 系統管理員可以尋找：

- 當可用記憶體少於 2 倍的重新整理資料集大小，會重新整理資料時可用的記憶體不足。
- 不重新整理與不在記憶體中重新整理之前，尚未開始顯示互動式流量繁重的重新整理時間期間的資料集。 若要查看哪些資料集時，會載入到記憶體上，在任何時候，Power BI 系統管理員可以查看的資料集區**資料集**應用程式中的索引標籤。 系統管理員可以再按一下其中一個橫條中跨篩選以指定的時間**每小時載入資料集計算**。 本機突然增加，顯示在下圖中，指出當多個資料集已載入至記憶體，可能會延遲排程的重新整理的開始小時。
- 排程資料重新整理開始時，就會放置採取更高的資料集區收回。 收回可能表示那里高的記憶體不足的壓力起因於提供太多不同的互動式報表重新整理的時間之前。 **每小時的資料集區收回和記憶體耗用量**視覺效果可清楚指出收回的暴增情況。

下圖顯示本機突然增加，在載入資料集，這表示互動式查詢延遲的重新整理的啟動。 選取時段以**每小時載入資料集計算**視覺效果會交叉篩選**資料集大小**視覺化。

![本機突然增加載入的資料集建議重新整理的互動式查詢的延遲的啟動](media/service-premium-capacity-scenarios/hourly-loaded-dataset-counts.png)

Power BI 系統管理員可以嘗試採取步驟，以確保有足夠的記憶體，僅適用於資料重新整理，以為著手解決此問題：

- 連絡資料集擁有者和要求他們以交錯進行，並分開的資料重新整理排程。
- 減少資料集查詢負載，藉由移除不必要的儀表板或儀表板圖格，特別是那些強制執行資料列層級安全性。
- 最佳化 Power Query 邏輯，以加速完成資料重新整理。 改善模型導出資料行或資料表。 減少資料集大小，或設定要執行累加式的資料重新整理的較大型資料集。

## <a name="identifying-slow-responding-datasets"></a>識別緩慢回應的資料集

在此案例中，調查開始時使用者抱怨特定的報告時間太長，無法開啟，且有時會停止回應。

在 應用程式，可以使用 Power BI 系統管理員**查詢持續時間**視覺效果，則依遞減排序資料集來判斷表現最差的資料集**平均持續時間**。 此視覺效果也會顯示資料集查詢計數，因此您可以看到資料集查詢的頻率。

![表現最差的資料集](media/service-premium-capacity-scenarios/worst-performing-datasets.png)

系統管理員可以參考**查詢持續時間分佈**視覺效果，其中會顯示的貯體的查詢效能的整體分佈 (< = 30 毫秒，0-100 毫秒) 的已篩選的期間。 一般而言，大部分的使用者;，採取一秒或更少視為回應的查詢需要較長時間的查詢，通常會建立效能不佳的感覺。

**每小時的查詢持續時間分佈**視覺效果，可讓 Power BI 系統管理員，以識別當處理能力效能可能有已發現的一小時期間，不佳。 愈多列區段代表查詢持續時間超過一秒，較大的使用者將會察覺效能不佳的風險。

視覺效果為互動式，並選取列的區段時，相對應**查詢持續時間**資料表視覺效果在報表頁面上會顯示它所代表的資料集進行交叉篩選。 此交叉篩選可讓 Power BI 系統管理員更容易找出其資料集回應速度較慢。

下圖顯示篩選的視覺效果**每小時的查詢持續時間分佈**、 焦表現最差一小時的貯體中的資料集。 

![篩選每小時查詢持續時間分佈視覺化顯示更糟的是執行資料集](media/service-premium-capacity-scenarios/hourly-query-duration-distributions.png)

一旦識別特定的一小時的時間範圍中的不佳的執行資料集，Power BI 系統管理員可以調查效能降低是否起因於多載的容量，或因為不良設計資料集或報表。 它們會參考**查詢等候時間**視覺效果和排序資料集，則依遞減平均查詢等候時間。 如果大量百分比的查詢正在等候，較高的需求，為資料集可能是太多的查詢等候的原因。 如果平均查詢等候時間可能很大 （> 100 毫秒），您也可以檢閱的資料集和報表以查看 如果可以進行最佳化。 例如，較少的視覺效果上所指定的報表頁面或 DAX 運算式最佳化。

![查詢等候時間視覺效果可協助以顯示 執行效能不佳的資料集](media/service-premium-capacity-scenarios/query-wait-times.png)

有資料集的查詢等候時間累積幾項可能因素：

- 次佳的模型設計、 量值運算式或甚至是報表設計-所有的情況下，可能造成長時間執行的耗用高 CPU 的查詢。 這會強制等候，直到 CPU 執行緒可供使用，且可以建立群組效果 （考慮場流量壅塞災難），在尖峰營業時間內中經常會看到新的查詢。 **查詢等候**頁將會是主要的資源，以判斷資料集是否有高的平均查詢等候時間。
- 大量的並行容量使用者 （數百至數千個） 使用相同的報表或資料集。 設計更完善的資料集可以超過並行臨界值的格式不執行。 這通常會由單一資料集的查詢計數比其他資料集顯示顯示大幅較高的值 (例如，300 K 查詢的一個資料集相較於 < 30k 查詢對於所有其他資料集)。 在某處，查詢等候此資料集將會啟動以交錯進行，您可以看到在**查詢持續時間**視覺化。
- 許多不同查詢的資料集同時也會造成過度置換為資料集經常循環流入和流出記憶體。 這會導致資料集載入至記憶體時，發生效能變慢的使用者。 若要確認，Power BI 系統管理員可以參考**每小時的資料集區收回和記憶體耗用量**視覺效果，這可能表示有大量的資料集載入到記憶體正在重複收回。

## <a name="identifying-causes-for-sporadically-slow-responding-datasets"></a>識別原因偶爾緩慢回應的資料集

在此案例中，調查開始時的使用者說明報表視覺效果有時已回應太慢，或可能會變得沒有回應，但在其他時候他們已接受的回應。

在 app 中，**查詢持續時間**區段用來以下列方式尋找發生錯誤之資料集：

- 在 **查詢持續時間**visual 系統管理員已篩選的資料集 （從最上層查詢的資料集開始） 的資料集，並檢查中的交叉篩選直條**每小時的查詢分佈**視覺化。
- 當單一的一小時橫條會顯示重大變更與其他的一小時長條，該資料集的所有查詢持續時間群組之間的比率 （例如，色彩之間的比例變更大幅），這表示此資料集示範偶爾發生變更效能。
- 顯示不規則的部分不佳的執行查詢，一小時長條表示的 timespan，其中該資料集已受其他資料集的活動所造成的吵雜鄰居 」 效果。

下圖顯示於 1 月 30 日的一小時發生重大的近來的資料集的效能時，所指定的大小 」 （3,10s]"執行持續時間貯體。 按一下該列的一小時，會顯示所有資料集載入至記憶體中，在這段時間，呈現可能造成吵雜的芳鄰效果的資料集。

![長條顯示大部分最差效能](media/service-premium-capacity-scenarios/worst-performing-queries.png)

一旦有問題的時間範圍期間已確認 （例如，年 1 月 30 在上圖中) 的 Power BI 系統管理員可以移除所有的資料集篩選，然後篩選只能由該時間範圍，以判斷哪些資料集已積極地查詢在這段期間。 吵雜的芳鄰效果發生錯誤之資料集通常是最上層的查詢資料集或一率最高平均查詢持續時間。

此問題的解決方案可能是將支援的資料集，透過不同的工作區或共用的容量，如果資料集的大小、 消耗需求和資料重新整理模式上不同的 Premium 容量的罪魁禍首。

反向可能也為 true。 Power BI 系統管理員可以識別當資料集查詢效能大幅改善的時間，然後尋找什麼消失。 如果遺漏在該時間點的特定資訊，，可能有助於指向而造成的問題。

## <a name="determining-whether-there-is-enough-memory"></a>判斷是否有足夠的記憶體

若要判斷是否有足夠的記憶體容量，以完成其工作負載，Power BI 系統管理員可以參考**耗用的記憶體百分比**中的視覺效果**資料集**應用程式 索引標籤。 **所有**記憶體 （總計） 表示載入記憶體，不論其為主動查詢或處理的資料集所耗用的記憶體。 **Active**記憶體代表正在主動處理的資料集所耗用的記憶體。

狀況良好的容量中視覺效果看起來像這樣，顯示所有 （總計） 之間的間距和作用中的記憶體：

![狀況良好的容量會顯示所有 （總計） 之間的間距和作用中的記憶體](media/service-premium-capacity-scenarios/memory-healthy-capacity.png)

在容量，發生記憶體不足的壓力，相同的視覺效果會清楚地顯示作用中的記憶體和總記憶體結合，這表示，就無法再將額外的資料集載入到記憶體。 Power BI 系統管理員可以在此情況下，按一下 **容量重新啟動**(在**進階選項**的系統管理員入口網站的 容量設定 區域)。 容量結果在中重新啟動所有的資料集正在從記憶體排清，並且允許使用者重新載入到記憶體中視需要 （藉由查詢或資料重新整理）。

![* * 使用 * * 記憶體正與 * * 所有 * * 記憶體](media/service-premium-capacity-scenarios/memory-unhealthy-capacity.png)

## <a name="determining-whether-there-is-enough-cpu"></a>判斷是否有足夠的 CPU

一般情況下，平均 CPU 使用率的容量，應保持低於 80%。 超過這個值表示容量已接近 CPU 飽和。

作業花費的時間超出預期，因為執行許多 CPU 的內容參數，因為它會嘗試處理所有作業的容量來表示 CPU 飽和的效果。 在較高的並行查詢進階容量，這被表示高查詢等候時間。 高查詢等候時間的結果會是比平常慢回應性。 當 CPU 已飽和藉由檢視時，Power BI 系統管理員可以輕鬆地識別**每小時查詢等候時間散發**視覺化。 定期的尖峰，查詢的等候計數表示潛在的 CPU 飽和的時間。

![定期的尖峰，查詢的等候計數表示潛在的 CPU 飽和的時間](media/service-premium-capacity-scenarios/peak-query-wait-times.png)

類似的模式只有參與 CPU 飽和的情況下，有時候可以在背景作業中偵測。 Power BI 系統管理員可以查看針對特定的資料集，可以指定當時的 CPU 飽和 （可能因為其他進行中的資料集重新整理和/或互動式查詢所使用） 的重新整理時間定期的尖峰。 在此情況下，指**系統**應用程式中的檢視可能不一定會顯示表示 CPU 就是 100%。 **系統**檢視會顯示每小時的平均值，但 CPU 可以變成飽和的數分鐘的繁重的作業，其顯示為尖峰在等候時間。

有更多細節，以查看 CPU 飽和的效果。 雖然等候的查詢數目很重要，查詢等候時間會永遠發生在某個程度，而不會造成明顯的效能降低。 某些資料集 （以較長者平均查詢時，表示複雜或大小） 是更容易發生 CPU 飽和的效果比其他項目。 若要輕鬆地識別這些資料集，Power BI 系統管理員可以尋找中橫條的色彩組合中的變更**每小時的等待時間分佈**視覺化。 之後找出極端值列，它們可以尋找已在這段期間的查詢等候資料集，並也查看相較於平均查詢持續時間的平均查詢等候時間。 當這兩個計量屬於相同，而且非一般資料集的查詢工作負載時，可能是大小的資料集大小的受到 CPU 資源不足。

簡短的高載高頻率查詢多個使用者 （例如，在訓練課程中），導致在每個高載期間的 CPU 飽和中取用資料集時，則此效果可能會特別顯著。 在此情況下，可以發生大量的查詢等候時間，在此資料集，以及影響在容量 （吵雜的芳鄰效果） 中的其他資料集。

在某些情況下，Power BI 系統管理員可以要求資料集擁有者，建立更少變動性的查詢工作負載，藉由建立儀表板 （定期使用的任何資料集的查詢重新整理快取的圖格） 而非報表。 這有助於防止暴增，載入儀表板時。 此解決方案不一定可將指定的商務需求，不過它可以為有效的方法，以避免 CPU 飽和，而不進行變更的資料集。

## <a name="acknowledgements"></a>通知

撰寫本文時已由 Peter Myers、 資料平台 MVP 和獨立 BI 專家[位元解決方案](https://www.bitwisesolutions.com.au/)。

## <a name="next-steps"></a>後續步驟

> [!div class="nextstepaction"]
> [監視與應用程式的 Premium 容量](service-admin-premium-monitor-capacity.md)    
> [!div class="nextstepaction"]
> [在管理入口網站中監視容量](service-admin-premium-monitor-portal.md)   

有其他問題嗎？ [嘗試在 Power BI 社群提問](https://community.powerbi.com/)

||||||